<!DOCTYPE html>
<html class="dark" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>MData - Upload Files</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#3b82f6",
              "primary-hover": "#2563eb",
              "background-light": "#f0f4f8",
              "background-dark": "#0f172a",
              "surface-dark": "#1e293b",
              "surface-light": "#ffffff",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
            },
            animation: {
              "fade-in": "fadeIn 0.5s ease-out",
              "slide-up": "slideUp 0.5s ease-out",
              "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
            },
            keyframes: {
              fadeIn: {
                "0%": { opacity: "0" },
                "100%": { opacity: "1" },
              },
              slideUp: {
                "0%": { transform: "translateY(20px)", opacity: "0" },
                "100%": { transform: "translateY(0)", opacity: "1" },
              },
            },
          },
        },
      };
    </script>
    <style>
      .glass,
      .glass-panel {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }
      .dark .glass,
      .dark .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05),
          0 2px 4px -1px rgba(0, 0, 0, 0.03);
      }
      .dark .glass-card {
        background: rgba(30, 41, 59, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2),
          0 2px 4px -1px rgba(0, 0, 0, 0.1);
      }
      body {
        background-image: radial-gradient(
            at 0% 0%,
            rgba(59, 130, 246, 0.15) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 0%,
            rgba(139, 92, 246, 0.15) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 100%,
            rgba(236, 72, 153, 0.15) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 0% 100%,
            rgba(34, 197, 94, 0.15) 0px,
            transparent 50%
          );
        background-attachment: fixed;
      }
      .dark body {
        background-image: radial-gradient(
            at 0% 0%,
            rgba(59, 130, 246, 0.1) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 0%,
            rgba(139, 92, 246, 0.1) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 100% 100%,
            rgba(236, 72, 153, 0.1) 0px,
            transparent 50%
          ),
          radial-gradient(
            at 0% 100%,
            rgba(34, 197, 94, 0.1) 0px,
            transparent 50%
          );
      }
      ::-webkit-scrollbar {
        width: 5px;
        height: 5px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(156, 163, 175, 0.2);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: rgba(156, 163, 175, 0.4);
      }
      .dark ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
      }
      .dark ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      .upload-zone {
        background: linear-gradient(
          145deg,
          rgba(59, 130, 246, 0.05),
          rgba(139, 92, 246, 0.05)
        );
        border: 2px dashed rgba(59, 130, 246, 0.3);
        transition: all 0.3s ease;
      }
      .upload-zone:hover {
        border-color: rgba(59, 130, 246, 0.6);
        background: linear-gradient(
          145deg,
          rgba(59, 130, 246, 0.1),
          rgba(139, 92, 246, 0.1)
        );
      }
      .upload-zone.dragover {
        border-color: #3b82f6;
        background: linear-gradient(
          145deg,
          rgba(59, 130, 246, 0.15),
          rgba(139, 92, 246, 0.15)
        );
        transform: scale(1.02);
      }
      /* Upload button states */
      .upload-button:disabled {
        background: #334155 !important;
        color: #64748b !important;
        cursor: not-allowed;
        box-shadow: none;
      }
      .upload-button.uploading {
        pointer-events: none;
        cursor: wait;
      }
    </style>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display antialiased text-slate-900 dark:text-white flex h-screen overflow-hidden selection:bg-primary/20 selection:text-primary"
  >
    <div class="relative z-10 flex h-full w-full">
      <div
        id="sidebar-overlay"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 hidden transition-opacity duration-300"
      ></div>
      <aside
        id="sidebar"
        class="fixed inset-y-0 left-0 z-50 flex flex-col w-72 h-full glass border-r border-gray-200/50 dark:border-white/5 shrink-0 transition-transform duration-300 -translate-x-full"
      >
        <div class="p-6 pb-8">
          <div class="flex items-center gap-3">
            <img
              src="../MData.png"
              alt="MData Logo"
              class="w-10 h-10 object-contain"
            />
            <div class="flex flex-col">
              <span
                class="font-bold text-lg tracking-tight text-gray-900 dark:text-white leading-none"
                >MData</span
              >
              <span
                class="text-xs text-gray-500 dark:text-gray-400 font-medium mt-1"
                >Uploader Portal</span
              >
            </div>
          </div>
        </div>
        <div class="flex-1 px-4 sidebar-scroll overflow-y-auto">
          <nav class="space-y-1.5 py-2">
            <a
              class="group flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-all duration-200"
              href="dashboard.html"
            >
              <span
                class="material-symbols-outlined text-[20px] text-gray-400 group-hover:text-primary-500 transition-colors"
                >dashboard</span
              >
              Dashboard
            </a>
            <a
              class="relative flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl bg-primary-50 dark:bg-primary-500/10 text-primary-600 dark:text-primary-400 transition-all duration-200 shadow-sm ring-1 ring-primary-500/20"
              href="upload_files.html"
            >
              <span
                class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-primary-500 rounded-r-full"
              ></span>
              <span class="material-symbols-outlined text-[20px] fill-1"
                >cloud_upload</span
              >
              Upload Files
            </a>
            <a
              class="group flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-all duration-200"
              href="file_history.html"
            >
              <span
                class="material-symbols-outlined text-[20px] text-gray-400 group-hover:text-primary-500 transition-colors"
                >history</span
              >
              File History
            </a>
            <a
              class="group flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-all duration-200"
              href="wallet.html"
            >
              <span
                class="material-symbols-outlined text-[20px] text-gray-400 group-hover:text-primary-500 transition-colors"
                >account_balance_wallet</span
              >
              Earnings
            </a>
            <a
              class="group flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white transition-all duration-200"
              href="profile.html"
            >
              <span
                class="material-symbols-outlined text-[20px] text-gray-400 group-hover:text-primary-500 transition-colors"
                >settings</span
              >
              Settings
            </a>
          </nav>
        </div>
        <div
          class="p-4 mt-auto border-t border-gray-200/50 dark:border-white/5 space-y-1"
        >
          <a
            href="profile.html"
            class="flex items-center gap-3 p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-white/5 transition-colors cursor-pointer group"
          >
            <div
              class="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center text-white shadow-sm"
            >
              <span class="material-symbols-outlined text-[20px]">person</span>
            </div>
            <div class="flex-1 min-w-0">
              <p
                id="user-name"
                class="text-sm font-semibold text-gray-900 dark:text-white truncate"
              >
                Loading...
              </p>
              <p
                id="user-email"
                class="text-xs text-gray-500 dark:text-gray-400 truncate"
              >
                loading...
              </p>
            </div>
          </a>
          <a
            href="../index.html"
            class="flex items-center gap-3 p-2 rounded-xl text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors group"
          >
            <span class="material-symbols-outlined text-[20px]">logout</span>
            <span class="text-sm font-semibold">Logout</span>
          </a>
        </div>
      </aside>

      <div class="flex-1 flex flex-col h-screen overflow-hidden relative z-10">
        <header
          class="h-16 glass border-b border-white/5 flex items-center justify-between px-6 sticky top-0 z-40"
        >
          <div class="flex items-center gap-4">
            <button
              class="sidebar-toggle p-2 -ml-2 text-slate-400 hover:text-white transition-colors"
            >
              <span class="material-symbols-outlined">menu</span>
            </button>
            <div class="flex items-center gap-3">
              <img src="../MData.png" alt="MData" class="h-8 w-8" />
              <span class="text-lg font-bold text-white hidden sm:inline"
                >MData</span
              >
            </div>
          </div>
          <h1 class="text-lg font-semibold text-white hidden md:block">
            Upload Files
          </h1>
          <div class="flex items-center gap-4">
            <a
              href="dashboard.html"
              class="flex items-center gap-2 px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm font-medium text-white hover:bg-white/10 transition-colors"
            >
              <span class="material-symbols-outlined text-[18px]"
                >arrow_back</span
              >
              <span class="hidden sm:inline">Dashboard</span>
            </a>
          </div>
        </header>

        <main class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 custom-scrollbar">
          <div class="max-w-6xl mx-auto space-y-6">
            <!-- Page Title -->
            <div class="animate-fade-in">
              <h2
                class="text-2xl sm:text-3xl font-bold text-white tracking-tight"
              >
                Upload Your Datasets
              </h2>
              <p class="text-slate-400 mt-1 font-light">
                High-quality data earns higher payouts. Add titles and tags for
                better discoverability.
              </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Left Column: Drop Zone & Files -->
              <div class="space-y-6">
                <!-- Drop Zone -->
                <div
                  id="drop-zone"
                  class="upload-zone glass-card rounded-2xl p-8 sm:p-12 cursor-pointer group relative overflow-hidden"
                >
                  <input
                    type="file"
                    id="file-input"
                    multiple
                    class="hidden"
                    accept="*/*"
                  />
                  <div
                    class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-500/20 to-purple-500/20 rounded-full blur-3xl -mr-16 -mt-16"
                  ></div>
                  <div
                    class="relative z-10 flex flex-col items-center text-center"
                  >
                    <div
                      class="w-20 h-20 rounded-2xl bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center text-white shadow-lg shadow-primary/30 mb-4 group-hover:scale-110 transition-transform"
                    >
                      <span class="material-symbols-outlined text-4xl"
                        >cloud_upload</span
                      >
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">
                      Drop files here
                    </h3>
                    <p class="text-slate-400 text-sm mb-4">
                      or click to browse from your device
                    </p>
                    <div
                      class="flex flex-wrap justify-center gap-2 text-xs text-slate-500"
                    >
                      <span
                        class="px-2 py-1 rounded-md bg-white/5 border border-white/10"
                        >Images</span
                      >
                      <span
                        class="px-2 py-1 rounded-md bg-white/5 border border-white/10"
                        >Documents</span
                      >
                      <span
                        class="px-2 py-1 rounded-md bg-white/5 border border-white/10"
                        >Code</span
                      >
                      <span
                        class="px-2 py-1 rounded-md bg-white/5 border border-white/10"
                        >Audio</span
                      >
                      <span
                        class="px-2 py-1 rounded-md bg-white/5 border border-white/10"
                        >CSV/JSON</span
                      >
                    </div>
                  </div>
                </div>

                <!-- Selected Files -->
                <div class="glass-card rounded-2xl p-5">
                  <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                      <div
                        class="w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center text-primary"
                      >
                        <span class="material-symbols-outlined">folder</span>
                      </div>
                      <div>
                        <h3 class="font-semibold text-white">Selected Files</h3>
                        <p class="text-xs text-slate-500">
                          <span id="file-count">0</span> files ready
                        </p>
                      </div>
                    </div>
                    <button
                      id="clear-all-btn"
                      class="text-xs text-red-400 hover:text-red-300 font-medium transition-colors"
                    >
                      Clear All
                    </button>
                  </div>
                  <div
                    id="file-list"
                    class="space-y-2 max-h-64 overflow-y-auto"
                  >
                    <div class="text-center py-8 text-slate-500 text-sm">
                      <span
                        class="material-symbols-outlined text-3xl mb-2 opacity-50 block"
                        >inventory_2</span
                      >
                      No files selected yet
                    </div>
                  </div>
                </div>
              </div>

              <!-- Right Column: Dataset Details -->
              <div class="space-y-6">
                <!-- Dataset Info Card -->
                <div class="glass-card rounded-2xl p-5 sm:p-6">
                  <div class="flex items-center gap-3 mb-6">
                    <div
                      class="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center text-white shadow-lg shadow-emerald-500/30"
                    >
                      <span class="material-symbols-outlined">edit_note</span>
                    </div>
                    <div>
                      <h3 class="font-semibold text-white">Dataset Details</h3>
                      <p class="text-xs text-slate-500">
                        Add info to boost visibility
                      </p>
                    </div>
                  </div>

                  <div class="space-y-5">
                    <div>
                      <label class="block text-sm font-medium text-white mb-2">
                        Dataset Title
                      </label>
                      <input
                        id="dataset-title"
                        type="text"
                        placeholder="e.g. Urban Street Photos 2024"
                        class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"
                      />
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-white mb-2">
                        Description
                        <span class="text-slate-500 font-normal"
                          >(Optional)</span
                        >
                      </label>
                      <textarea
                        id="dataset-description"
                        rows="3"
                        placeholder="Describe contents, source, and potential use cases..."
                        class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all resize-none"
                      ></textarea>
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-white mb-2">
                        Tags
                        <span class="text-slate-500 font-normal"
                          >(Better tags = higher score)</span
                        >
                      </label>
                      <div
                        id="tags-container"
                        class="flex flex-wrap gap-2 mb-3"
                      ></div>
                      <div class="flex gap-2">
                        <input
                          id="tag-input"
                          type="text"
                          placeholder="Add a tag and press Enter..."
                          class="flex-1 px-4 py-2.5 rounded-xl bg-white/5 border border-white/10 text-white placeholder-slate-500 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all text-sm"
                        />
                        <button
                          id="add-tag-btn"
                          class="px-4 py-2.5 rounded-xl bg-primary/10 border border-primary/20 text-primary hover:bg-primary/20 transition-colors"
                        >
                          <span class="material-symbols-outlined text-[18px]"
                            >add</span
                          >
                        </button>
                      </div>
                    </div>
                  </div>

                  <!-- Upload Tips -->
                  <div class="mt-6 pt-6 border-t border-white/10">
                    <h4
                      class="text-sm font-semibold text-white mb-3 flex items-center gap-2"
                    >
                      <span
                        class="material-symbols-outlined text-primary text-[18px]"
                        >tips_and_updates</span
                      >
                      Tips for Higher Quality Scores
                    </h4>
                    <ul class="space-y-2 text-xs text-slate-400">
                      <li class="flex items-start gap-2">
                        <span
                          class="material-symbols-outlined text-emerald-500 text-[14px] mt-0.5"
                          >check_circle</span
                        >
                        Add descriptive titles and accurate tags
                      </li>
                      <li class="flex items-start gap-2">
                        <span
                          class="material-symbols-outlined text-emerald-500 text-[14px] mt-0.5"
                          >check_circle</span
                        >
                        Upload high-resolution images (min 1080p)
                      </li>
                      <li class="flex items-start gap-2">
                        <span
                          class="material-symbols-outlined text-emerald-500 text-[14px] mt-0.5"
                          >check_circle</span
                        >
                        Ensure data is clean and well-structured
                      </li>
                      <li class="flex items-start gap-2">
                        <span
                          class="material-symbols-outlined text-emerald-500 text-[14px] mt-0.5"
                          >check_circle</span
                        >
                        Provide detailed descriptions for context
                      </li>
                    </ul>
                  </div>
                </div>

                <!-- Terms & Submit -->
                <div class="glass-card rounded-2xl p-5 sm:p-6">
                  <div class="flex items-start gap-3 mb-6">
                    <div class="relative flex items-center pt-0.5">
                      <input
                        class="peer h-5 w-5 cursor-pointer appearance-none rounded border border-slate-600 bg-slate-800 checked:border-primary checked:bg-primary transition-all focus:ring-offset-0 focus:ring-2 focus:ring-primary/50"
                        id="legal"
                        type="checkbox"
                      />
                      <span
                        class="material-symbols-outlined pointer-events-none absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-white opacity-0 peer-checked:opacity-100 text-[16px]"
                        >check</span
                      >
                    </div>
                    <label
                      class="text-sm text-slate-400 leading-snug cursor-pointer select-none"
                      for="legal"
                    >
                      I certify that the content complies and I agree to the
                      <a
                        id="tos-link"
                        class="text-primary hover:text-blue-400 underline underline-offset-2 cursor-pointer"
                        >Terms of Service</a
                      >.
                    </label>
                  </div>

                  <div
                    class="flex flex-col sm:flex-row items-center justify-between gap-4 pt-4 border-t border-white/10"
                  >
                    <div class="flex gap-6 text-sm">
                      <div class="text-center">
                        <span class="text-slate-500 block">Platform</span>
                        <span class="font-bold text-white">20%</span>
                      </div>
                      <div class="w-px bg-white/10"></div>
                      <div class="text-center">
                        <span class="text-slate-500 block">You keep</span>
                        <span class="font-bold text-emerald-400">80%</span>
                      </div>
                    </div>
                    <button
                      id="upload-btn"
                      disabled
                      class="upload-button w-full sm:w-auto flex items-center justify-center gap-2 px-8 py-3 rounded-xl font-bold text-white transition-all bg-gradient-to-r from-primary to-blue-600 hover:from-blue-600 hover:to-primary shadow-lg shadow-primary/25 active:scale-[0.98]"
                    >
                      <span>Upload & Submit</span>
                      <span class="material-symbols-outlined text-[20px]"
                        >arrow_forward</span
                      >
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Terms of Service Modal -->
    <div
      id="tos-modal"
      class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
    >
      <div
        class="glass-card rounded-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col shadow-2xl"
      >
        <div
          class="flex items-center justify-between p-6 border-b border-white/10"
        >
          <h2 class="text-2xl font-bold text-white">Terms of Service</h2>
          <button
            id="close-tos"
            class="p-2 hover:bg-white/10 rounded-lg transition-colors"
          >
            <span class="material-symbols-outlined text-slate-400">close</span>
          </button>
        </div>
        <div class="overflow-y-auto p-6 text-sm text-slate-300 space-y-4">
          <div>
            <h3 class="font-bold text-lg mb-2 text-white">
              1. User Submissions & Grant of Rights
            </h3>
            <p>
              Users may upload content ("Submitted Data") including but not
              limited to Photos, Documents, Audio, Video, and Code. By
              submitting, you represent that you hold all necessary rights and
              that the content is not subject to any third-party claims.
            </p>
          </div>
          <div>
            <h3 class="font-bold text-lg mb-2 text-white">2. License Grant</h3>
            <p>
              By uploading content to the platform, you grant MData a
              non-exclusive, worldwide, royalty-free license to use, reproduce,
              modify, and distribute your content for AI training and related
              purposes.
            </p>
          </div>
          <div>
            <h3 class="font-bold text-lg mb-2 text-white">
              3. Prohibited Content
            </h3>
            <p>
              You may not upload content that is illegal, harmful, threatening,
              abusive, harassing, defamatory, vulgar, obscene, or otherwise
              objectionable. We reserve the right to remove any content that
              violates these terms.
            </p>
          </div>
          <div>
            <h3 class="font-bold text-lg mb-2 text-white">4. Payment Terms</h3>
            <p>
              Payments are calculated based on the quality score assigned to
              your content by our AI evaluation system. The platform retains 20%
              of all earnings as a service fee. Minimum withdrawal amount is
              â‚¹100.
            </p>
          </div>
        </div>
        <div class="p-6 border-t border-white/10">
          <button
            id="close-tos-btn"
            class="w-full py-3 rounded-xl bg-primary hover:bg-blue-600 text-white font-semibold transition-colors"
          >
            I Understand
          </button>
        </div>
      </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed bottom-6 right-6 z-50 hidden">
      <div
        class="glass-card rounded-xl p-4 border border-white/10 shadow-2xl flex items-center gap-3 animate-slide-up"
      >
        <div
          id="toast-icon"
          class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-400"
        >
          <span class="material-symbols-outlined">error</span>
        </div>
        <div class="flex-1">
          <p id="toast-message" class="text-sm text-white font-medium">
            Something went wrong
          </p>
        </div>
        <button
          onclick="closeToast()"
          class="text-slate-500 hover:text-white transition-colors"
        >
          <span class="material-symbols-outlined text-[20px]">close</span>
        </button>
      </div>
    </div>

    <script>
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("sidebar-overlay");
      const toggleButtons = document.querySelectorAll(".sidebar-toggle");

      function toggleSidebar() {
        sidebar.classList.toggle("-translate-x-full");
        overlay.classList.toggle("hidden");
      }

      toggleButtons.forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          toggleSidebar();
        });
      });
      overlay.addEventListener("click", toggleSidebar);

      // Toast Helper Functions
      function showToast(message, type = "error") {
        const toast = document.getElementById("notification-toast");
        const toastMessage = document.getElementById("toast-message");
        const toastIcon = document.getElementById("toast-icon");

        toastMessage.textContent = message;

        if (type === "success") {
          toastIcon.className =
            "w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-400";
          toastIcon.innerHTML =
            '<span class="material-symbols-outlined">check_circle</span>';
        } else if (type === "warning") {
          toastIcon.className =
            "w-10 h-10 rounded-full bg-yellow-500/10 flex items-center justify-center text-yellow-400";
          toastIcon.innerHTML =
            '<span class="material-symbols-outlined">warning</span>';
        } else {
          toastIcon.className =
            "w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-400";
          toastIcon.innerHTML =
            '<span class="material-symbols-outlined">error</span>';
        }

        toast.classList.remove("hidden");

        if (type !== "success") {
          setTimeout(() => closeToast(), 4000);
        }
      }

      function closeToast() {
        document.getElementById("notification-toast").classList.add("hidden");
      }

      // --- Real Upload Logic ---
      document.addEventListener("DOMContentLoaded", () => {
        const userStr = localStorage.getItem("user");
        if (!userStr) {
          window.location.href = "../index.html";
          return;
        }
        const user = JSON.parse(userStr);
        document.getElementById("user-name").textContent = user.name;
        document.getElementById("user-email").textContent = user.email;

        const dropZone = document.getElementById("drop-zone");
        const fileInput = document.getElementById("file-input");
        const fileListContainer = document.getElementById("file-list");
        const uploadBtn = document.getElementById("upload-btn");

        // Tags functionality
        const tagInput = document.getElementById("tag-input");
        const addTagBtn = document.getElementById("add-tag-btn");
        const tagsContainer = document.getElementById("tags-container");
        let userTags = [];

        function renderTags() {
          tagsContainer.innerHTML = userTags
            .map(
              (tag, index) => `
            <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm bg-primary/10 text-primary border border-primary/20">
              ${tag}
              <button onclick="removeTag(${index})" class="hover:text-red-400 transition-colors ml-1">
                <span class="material-symbols-outlined text-[14px]">close</span>
              </button>
            </span>
          `
            )
            .join("");
        }

        function addTag() {
          const tag = tagInput.value.trim().toLowerCase();
          if (tag && !userTags.includes(tag)) {
            userTags.push(tag);
            renderTags();
            tagInput.value = "";
          }
        }

        window.removeTag = (index) => {
          userTags.splice(index, 1);
          renderTags();
        };

        tagInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            addTag();
          }
        });

        addTagBtn.addEventListener("click", addTag);

        let selectedFiles = [];

        // Trigger file input
        dropZone.addEventListener("click", () => fileInput.click());

        // Handle File Selection
        fileInput.addEventListener("change", (e) => {
          handleFiles(Array.from(e.target.files));
        });

        // Drag & Drop
        dropZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          dropZone.classList.add("dragover");
        });
        dropZone.addEventListener("dragleave", () => {
          dropZone.classList.remove("dragover");
        });
        dropZone.addEventListener("drop", (e) => {
          e.preventDefault();
          dropZone.classList.remove("dragover");
          handleFiles(Array.from(e.dataTransfer.files));
        });

        function handleFiles(files) {
          selectedFiles = [...selectedFiles, ...files];
          renderFiles();
        }

        function renderFiles() {
          if (selectedFiles.length === 0) {
            fileListContainer.innerHTML = `
              <div class="text-center py-8 text-slate-500 text-sm">
                <span class="material-symbols-outlined text-3xl mb-2 opacity-50 block">inventory_2</span>
                No files selected yet
              </div>
            `;
          } else {
            fileListContainer.innerHTML = "";
            selectedFiles.forEach((file, index) => {
              const html = `
                <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/5 hover:border-primary/20 transition-all group">
                  <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary shrink-0">
                    <span class="material-symbols-outlined text-[20px]">description</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-white truncate">${
                      file.name
                    }</p>
                    <p class="text-xs text-slate-500">${(
                      file.size /
                      1024 /
                      1024
                    ).toFixed(2)} MB</p>
                  </div>
                  <button onclick="removeFile(${index})" class="p-2 text-slate-500 hover:text-red-400 transition-colors">
                    <span class="material-symbols-outlined text-[18px]">delete</span>
                  </button>
                </div>`;
              fileListContainer.insertAdjacentHTML("beforeend", html);
            });
          }
          const countEl = document.getElementById("file-count");
          if (countEl) countEl.textContent = selectedFiles.length;
        }

        window.removeFile = (index) => {
          selectedFiles.splice(index, 1);
          renderFiles();
        };

        const clearAllBtn = document.getElementById("clear-all-btn");
        if (clearAllBtn) {
          clearAllBtn.addEventListener("click", () => {
            selectedFiles = [];
            renderFiles();
          });
        }

        // Terms of Service Modal
        const tosModal = document.getElementById("tos-modal");
        const tosLink = document.getElementById("tos-link");
        const closeTosBtn = document.getElementById("close-tos-btn");
        const closeTosX = document.getElementById("close-tos");

        tosLink.addEventListener("click", (e) => {
          e.preventDefault();
          tosModal.classList.remove("hidden");
          tosModal.classList.add("flex");
        });

        closeTosBtn.addEventListener("click", () => {
          tosModal.classList.add("hidden");
          tosModal.classList.remove("flex");
        });

        closeTosX.addEventListener("click", () => {
          tosModal.classList.add("hidden");
          tosModal.classList.remove("flex");
        });

        tosModal.addEventListener("click", (e) => {
          if (e.target === tosModal) {
            tosModal.classList.add("hidden");
            tosModal.classList.remove("flex");
          }
        });

        // Enable/Disable Upload Button based on checkbox
        const termsCheckbox = document.getElementById("legal");
        termsCheckbox.addEventListener("change", () => {
          uploadBtn.disabled = !termsCheckbox.checked;
        });

        // Upload Process
        uploadBtn.addEventListener("click", async () => {
          if (selectedFiles.length === 0) {
            showToast("Please select files first.", "warning");
            return;
          }

          if (!termsCheckbox.checked) {
            showToast(
              "Please accept the Terms of Service before uploading.",
              "warning"
            );
            return;
          }

          const btnText = uploadBtn.querySelector("span:first-child");
          const originalText = btnText.textContent;
          btnText.textContent = "Uploading...";
          uploadBtn.classList.add("uploading");

          try {
            for (const file of selectedFiles) {
              const sasRes = await fetch(
                `/api/storage/sas?filename=${encodeURIComponent(file.name)}`
              );
              const { sasUrl } = await sasRes.json();

              if (!sasUrl) throw new Error("Failed to get upload token");

              const sasUrlObj = new URL(sasUrl);
              const blobUrl = `${sasUrlObj.origin}${
                sasUrlObj.pathname
              }/${encodeURIComponent(file.name)}${sasUrlObj.search}`;

              const datasetTitle = document
                .getElementById("dataset-title")
                .value.trim();
              const datasetDescription = document
                .getElementById("dataset-description")
                .value.trim();
              const tagsString = userTags.join(",");

              await fetch(blobUrl, {
                method: "PUT",
                headers: {
                  "x-ms-blob-type": "BlockBlob",
                  "x-ms-meta-userid": user.id,
                  "x-ms-meta-title": encodeURIComponent(datasetTitle),
                  "x-ms-meta-description":
                    encodeURIComponent(datasetDescription),
                  "x-ms-meta-usertags": encodeURIComponent(tagsString),
                },
                body: file,
              });

              try {
                const processRes = await fetch("/api/process-file", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    blobName: file.name,
                    userId: user.id,
                    originalName: file.name,
                    fileSize: file.size,
                  }),
                });
                const processResult = await processRes.json();
                console.log("File processed:", processResult);
              } catch (processErr) {
                console.warn(
                  "Process API failed, file will be processed later:",
                  processErr
                );
              }
            }

            showToast("Upload & Processing Complete!", "success");

            const uploadedFileNames = selectedFiles.map((f) => f.name);
            selectedFiles = [];
            renderFiles();
            btnText.textContent = originalText;
            uploadBtn.classList.remove("uploading");

            let pollAttempts = 0;
            const maxAttempts = 4;

            async function pollForProcessedFile() {
              pollAttempts++;
              try {
                const statsRes = await fetch(`/api/stats?userId=${user.id}`);
                const stats = await statsRes.json();

                if (stats.history && stats.history.length > 0) {
                  const found = stats.history.some((file) =>
                    uploadedFileNames.some(
                      (name) =>
                        (file.name && file.name.includes(name)) ||
                        (file.original_name &&
                          file.original_name.includes(name))
                    )
                  );

                  if (found) {
                    showToast(
                      "File processed! Redirecting to dashboard...",
                      "success"
                    );
                    setTimeout(() => {
                      window.location.href = "dashboard.html";
                    }, 1000);
                    return;
                  }
                }

                if (pollAttempts < maxAttempts) {
                  showToast(
                    `Processing... (${pollAttempts}/${maxAttempts})`,
                    "success"
                  );
                  setTimeout(pollForProcessedFile, 5000);
                } else {
                  showToast("Redirecting to dashboard...", "success");
                  setTimeout(() => {
                    window.location.href = "dashboard.html";
                  }, 1000);
                }
              } catch (err) {
                console.error("Poll error:", err);
                setTimeout(() => {
                  window.location.href = "dashboard.html";
                }, 2000);
              }
            }

            setTimeout(pollForProcessedFile, 3000);
          } catch (error) {
            console.error("Upload failed", error);
            showToast("Upload failed: " + error.message, "error");
            btnText.textContent = originalText;
            uploadBtn.classList.remove("uploading");
          }
        });
      });
    </script>
  </body>
</html>
